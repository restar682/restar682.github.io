<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CS143-PA3：Parsing | restar682's blog</title><meta name="author" content="restar682"><meta name="copyright" content="restar682"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CS143 PA3：实现 Cool 语言的语法分析器。">
<meta property="og:type" content="article">
<meta property="og:title" content="CS143-PA3：Parsing">
<meta property="og:url" content="http://restar682.github.io/2025/08/10/CS143-PA3%EF%BC%9AParsing/index.html">
<meta property="og:site_name" content="restar682's blog">
<meta property="og:description" content="CS143 PA3：实现 Cool 语言的语法分析器。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://restar682.github.io/img/head-sculpture.jpg">
<meta property="article:published_time" content="2025-08-10T04:14:47.000Z">
<meta property="article:modified_time" content="2025-08-20T02:49:49.542Z">
<meta property="article:author" content="restar682">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="编译原理">
<meta property="article:tag" content="CS143">
<meta property="article:tag" content="语法分析">
<meta property="article:tag" content="抽象语法树">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://restar682.github.io/img/head-sculpture.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CS143-PA3：Parsing",
  "url": "http://restar682.github.io/2025/08/10/CS143-PA3%EF%BC%9AParsing/",
  "image": "http://restar682.github.io/img/head-sculpture.jpg",
  "datePublished": "2025-08-10T04:14:47.000Z",
  "dateModified": "2025-08-20T02:49:49.542Z",
  "author": [
    {
      "@type": "Person",
      "name": "restar682",
      "url": "http://restar682.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://restar682.github.io/2025/08/10/CS143-PA3%EF%BC%9AParsing/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CS143-PA3：Parsing',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="https://cdn2.codesign.qq.com/icons/XMx86jzlQw0brz3/latest/iconfont.css"><link rel="stylesheet" href="/css/corgi.css"><link rel="stylesheet" href="/css/modify.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<link rel="stylesheet" href="/css/categorybar.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/images/background.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head-sculpture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-image"></i><span> 图库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/images/"><i class="fa-fw fas fa-images"></i><span> 存图</span></a></li><li><a class="site-page child" href="/my-images/"><i class="fa-fw fas fa-bolt"></i><span> 私图</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/" title="回到主页"><span class="site-name">restar682's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">CS143-PA3：Parsing</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-image"></i><span> 图库</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/images/"><i class="fa-fw fas fa-images"></i><span> 存图</span></a></li><li><a class="site-page child" href="/my-images/"><i class="fa-fw fas fa-bolt"></i><span> 私图</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div><div id="nav-right"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CS143-PA3：Parsing</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-10T04:14:47.000Z" title="发表于 2025-08-10 12:14:47">2025-08-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-20T02:49:49.542Z" title="更新于 2025-08-20 10:49:49">2025-08-20</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CS143/">CS143</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><blockquote>
<p>前排提醒：本文采用 C++ 实现，如果使用 java 建议参考其他文章。</p>
</blockquote>
<h1 id="语法分析"><a href="#语法分析" class="headerlink" title="语法分析"></a>语法分析</h1><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>本次作业的目标是：使用 Bison 实现一个可以将 Token 序列转换为 AST 的语法分析器。</p>
<p>在 <code>assignments/PA3</code> 目录下执行命令：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make parser</span><br></pre></td></tr></tbody></table></figure>
<p>会生成一个名为 <code>parser</code> 的可执行文件，可以通过运行 <code>./myparser test.cl</code> 来对指定文件进行词法分析。这里的 <code>myparser</code> 是一个 <code>csh</code> 脚本，如果用的是 <code>bash</code> 的话需要将开头的 <code>csh</code> 改成 <code>bash</code>，或者直接运行</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./lexer test.cl | ./parser</span><br></pre></td></tr></tbody></table></figure>
<p>在编译过程中，Bison 生成的 <code>cool-parse.cc</code> 负责语法分析的主要实现；<code>parser-phase.cc</code> 提供程序入口，负责驱动并测试语法分析器；<code>cool-tree.aps</code> 定义 AST 结构，并自动生成 <code>cool-tree.h</code> 与 <code>cool-tree.cc</code> 以支持树节点的构造与处理，剩下的 <code>tokens-lex.cc</code>、<code>dumptype.cc</code> 和 <code>handle_flags.cc</code> 等文件为辅助代码，不需要修改。</p>
<p>这里所用到的 <strong>Bison</strong> 是一种语法分析器生成工具，它能够根据上下文无关文法规则自动生成语法分析器。其作用是将 <code>.y</code> 文件转换为 C/C++ 源码（如 <code>cool-parse.cc</code>），并作为库函数与其他源码一起编译。目前我们通过 <code>parser-phase.cc</code> 来调用生成的语法分析器代码，后续可能会通过编译器的其他阶段（如语义分析器）来调用。</p>
<p>Bison 的使用可以通过阅读 <strong>Bison 的官方文档</strong> 以及 <code>handouts</code> 目录下的相关 PDF 来了解，比如 PA3 的作业说明里面有相关介绍。</p>
<p>回到 PA3，我们的核心任务是完善 <code>cool.y</code> 文件，使其能够正确地进行语法分析。</p>
<h2 id="Bison-简单介绍"><a href="#Bison-简单介绍" class="headerlink" title="Bison 简单介绍"></a>Bison 简单介绍</h2><h3 id="文件结构概述"><a href="#文件结构概述" class="headerlink" title="文件结构概述"></a>文件结构概述</h3><p>Bison 文件由三部分组成，每个部分之间用 <code>%%</code> 隔开：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">definitions</span><br><span class="line">%%</span><br><span class="line">rules</span><br><span class="line">%%</span><br><span class="line">user code</span><br></pre></td></tr></tbody></table></figure>
<h4 id="1-definitions（定义区）"><a href="#1-definitions（定义区）" class="headerlink" title="1. definitions（定义区）"></a>1. definitions（定义区）</h4><p>这一部分用于声明语法分析器所需的各种信息，类似于 C 文件的头部。在这里可以：</p>
<ul>
<li><strong>声明终结符</strong>：告诉 Bison 所有词法单元（由 Flex 提供）；</li>
<li><strong>声明非终结符的属性类型</strong>：通过 <code>%type</code> 指定每个非终结符使用 <code>union</code> 中的哪个成员；</li>
<li><strong>定义属性的联合体</strong>：统一表示所有语法树节点或值的类型；</li>
<li><strong>指定起始符号</strong>（可选）；</li>
<li><strong>包含头文件</strong>、<strong>定义宏</strong>或<strong>声明全局变量</strong>（用 <code>%{ ... %}</code> 包裹）。</li>
</ul>
<p>常用声明语法：</p>
<ul>
<li><p><strong><code>%union</code></strong>：定义所有可能的属性类型，类型不同储存用到的字段也不同（通常是语法树节点指针）：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%union {</span><br><span class="line">    int           int_val;</span><br><span class="line">    char*         string_val;</span><br><span class="line">    Program       program;</span><br><span class="line">    Expression    expr;</span><br><span class="line">    ···</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong><code>%token</code></strong>：声明终结符，可带类型（即使用 <code>union</code> 中的哪个字段），还可手动指定终结符数字编号：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">%token &lt;int_val&gt;  INTEGER</span><br><span class="line">%token &lt;string_val&gt; IDENTIFIER STRING_CONST</span><br><span class="line">%token IF THEN ELSE FI</span><br><span class="line"> /* 手动指定编号*/</span><br><span class="line">%token INHERITS 263 LET 264 LOOP 265 POOL 266 THEN 267 WHILE 268  </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong><code>%type</code></strong>：声明非终结符储存的使用的字段：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%type &lt;program&gt; program</span><br><span class="line">%type &lt;expr&gt;    expression if_expr while_expr</span><br><span class="line">%type &lt;stmt&gt;    statement assign_stmt block_stmt</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p><strong><code>%start</code></strong>：指定文法的开始符号（默认为第一条规则的左部）：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%start program</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<blockquote>
<p>注意：所有带属性的终结符和非终结符都必须用 <code>%token</code> 或 <code>%type</code> 声明储存使用的字段，否则 Bison 不知道如何存储它们的值，会导致运行时错误。</p>
</blockquote>
<h4 id="2-rules（语法规则区）"><a href="#2-rules（语法规则区）" class="headerlink" title="2. rules（语法规则区）"></a>2. rules（语法规则区）</h4><p>这是 Bison 文件的核心部分，我们在这里定义 CFG，描述语言的语法结构。</p>
<p>每条规则的形式如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">非终结符: 产生式右部    { 动作代码 }</span><br><span class="line">        | 产生式右部    { 动作代码 }</span><br><span class="line">        ;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>非终结符</code>：必须在 <code>%type</code> 中声明过（如果有属性）；</li>
<li><code>产生式右部</code>：由终结符、非终结符或其他符号组成；</li>
<li><code>{ 动作代码 }</code>：当该规则被归约时执行的 C/C++ 代码，通常用于构造语法树节点。</li>
</ul>
<h5 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h5><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">expression: expression '+' expression</span><br><span class="line">          { $$ = plus($1, $3); }  // $1 是左 expression，$3 是右 expression，$$ 是当前 expression</span><br><span class="line">        | IDENTIFIER</span><br><span class="line">          { $$ = identifier($1); }</span><br><span class="line">        | INTEGER</span><br><span class="line">          { $$ = integer_const($1); }</span><br><span class="line">        ;</span><br></pre></td></tr></tbody></table></figure>
<h5 id="重要规则："><a href="#重要规则：" class="headerlink" title="重要规则："></a>重要规则：</h5><ul>
<li>每条规则必须以 <code>;</code> 结尾；</li>
<li><code>$1</code>, <code>$2</code>, …, <code>$n</code> 表示右部第 1 到第 n 个符号的属性值；</li>
<li>$$$$ 表示当前非终结符的属性值（即归约后的结果）；</li>
<li>动作代码必须用 <code>{}</code> 括起来，且不能与规则在同一行（除非缩进，一般另起一行）；</li>
<li>多条规则可以用 <code>|</code> 连接，表示“或”的关系。</li>
</ul>
<h4 id="3-user-code（用户代码区）"><a href="#3-user-code（用户代码区）" class="headerlink" title="3. user code（用户代码区）"></a>3. user code（用户代码区）</h4><p>这一部分用于编写辅助函数、语法树构造函数、错误处理函数等 C/C++ 代码。</p>
<p>可以在这里定义：</p>
<ul>
<li>语法树节点的构造函数（如 <code>plus()</code>, <code>identifier()</code>）；</li>
<li>错误报告函数（如 <code>yyerror(const char *msg)</code>）；</li>
<li>工具函数、内存管理逻辑等。</li>
</ul>
<p>例如：</p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">yyerror</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *msg)</span> {</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"Parse error at line %d: %s\n"</span>, lineno, msg);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> {</span><br><span class="line">    yyparse();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>注意：<code>yyerror</code> 是 Bison 自动生成调用的错误处理函数，必须实现。</p>
</blockquote>
<h3 id="属性与语义值"><a href="#属性与语义值" class="headerlink" title="属性与语义值"></a>属性与语义值</h3><p>Bison 支持<strong>带属性的文法符号</strong>，用于 AST 或传递信息。</p>
<ul>
<li>所有属性通过 <code>%union</code> 统一管理；</li>
<li>每个符号的属性值通过 $$$$, <code>$1</code>, <code>$2</code> 等访问；</li>
<li>属性类型必须与 <code>%token</code> 或 <code>%type</code> 声明一致，否则会导致类型错误或程序崩溃。</li>
</ul>
<blockquote>
<p>类型错误可能导致程序在运行时崩溃（如把指针存到整数字段）。</p>
</blockquote>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><h4 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h4><ul>
<li><p><strong>特殊 token <code>error</code></strong></p>
<ul>
<li>由 Bison 自动定义，用于错误处理，不需要在文法中声明。</li>
<li>当出现语法错误时，解析器会生成该 token。</li>
<li>如果当前上下文有匹配 <code>error</code> 的规则，解析器就能继续工作。</li>
</ul>
</li>
<li><p><strong>错误恢复流程</strong></p>
<ol>
<li>发生语法错误 → 生成 <code>error</code> token。</li>
<li>弹出状态栈（丢弃部分语义上下文）直到找到可接受 <code>error</code> 的状态。</li>
<li>移入 <code>error</code> token。</li>
<li>如果下一个 token 解释器无法接受 → 丢弃输入 token，直到找到可接受的 token。</li>
<li>继续按照匹配的错误规则执行。</li>
</ol>
</li>
<li><p><strong>常见恢复策略</strong></p>
<ul>
<li><strong>跳过当前语句</strong><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stmt: error ';'  /* 错误时跳过直到 ';' */</span><br></pre></td></tr></tbody></table></figure></li>
<li><strong>跳过到匹配的闭合符</strong><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">primary:</span><br><span class="line">  '(' expr ')'</span><br><span class="line">| '(' error ')'</span><br><span class="line">;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><ul>
<li><p><strong>规则动作</strong><br>错误规则和普通规则一样，可以有动作代码。</p>
</li>
<li><p><strong>错误消息抑制</strong></p>
<ul>
<li>避免错误雪崩：恢复后，如果连续 3 个 token 没有被成功移入，不会输出新错误。</li>
<li>宏 <code>yyerrok;</code>：立即恢复错误消息输出。</li>
<li>宏 <code>yyclearin;</code>：清除当前 lookahead token，让扫描器重新提供一个 token。</li>
</ul>
</li>
<li><p><strong>状态检测</strong></p>
<ul>
<li><code>YYRECOVERING()</code>：判断当前是否在错误恢复状态（1 表示正在恢复）。</li>
</ul>
</li>
</ul>
<h2 id="Cool-语言的-AST-包"><a href="#Cool-语言的-AST-包" class="headerlink" title="Cool 语言的 AST 包"></a>Cool 语言的 AST 包</h2><p>为了将 Token 序列转换成 AST，我们肯定要了解 Cool 语言的 AST 的定义。（<del>怎么这么多要了解的东西</del>）</p>
<p>Cool 语言的 AST 代码由 <code>cool-tree.aps</code> 文件中的规范自动生成。虽然这些代码结构简单、规则统一，但由于缺乏注释，阅读和理解起来并不直观。接下来，我们将参考 <code>handouts/cool-tour</code> 第六节的内容，对其结构进行分析和理解。</p>
<h3 id="APS-简介"><a href="#APS-简介" class="headerlink" title="APS 简介"></a>APS 简介</h3><p>Cool 语言的抽象语法在 APS 中定义。在 APS 术语中，抽象语法树的各种节点（如 let、<code>+</code> 等）被称为构造器。AST 的格式由一组 <strong>门类（phyla）</strong> 描述，每个门类包含一个或多个构造器，用于表示特定类型的语法结构。</p>
<p>门类本质上就是类型，它是我们根据功能对构造器进行分组后确定的。例如，将表达式 AST 的构造器与类 AST 的构造器区分开来。门类的定义位于 <code>cool-tree.aps</code> 文件的开头。<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module COOL[] begin</span><br><span class="line">  phylum Program;</span><br><span class="line">  phylum Class_;</span><br><span class="line">  phylum Classes = LIST [Class_];</span><br><span class="line">  phylum Feature;</span><br><span class="line">  phylum Features = LIST [Feature];</span><br><span class="line">  phylum Formal;</span><br><span class="line">  ···</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>从定义可以看出，门类分为两种类型：“正常”门类和“列表”门类。正常门类关联有构造器，列表门类则定义有一组固定的列表操作。</p>
<p>每个构造器都接受带有明确类型的参数，并返回带有明确类型的结果。参数类型可以是先前定义的门类或任何普通的 C++ 类型。实际上，门类的声明会被 APS 编译器转换成对应的 <strong>C++</strong> 类声明。例如：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">constructor class_(name : Symbol; parent: Symbol; features : Features; filename : Symbol) : Class_;</span><br></pre></td></tr></tbody></table></figure>
<p>此声明指定 <code>class_</code> 构造函数接受四个参数：</p>
<ol>
<li><code>Symbol</code>（类型标识符）用于类名  </li>
<li><code>Symbol</code>（类型标识符）用于父类  </li>
<li><code>Features</code>（由 <code>Feature</code> 构成的列表）  </li>
<li><code>Symbol</code> 用于存放类定义的文件名</li>
</ol>
<p><code>class_</code> 构造函数返回类型为 <code>Class_</code> 的 AST 节点。在 <code>cool.y</code> 中，使用示例如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class : CLASS TYPEID INHERITS TYPEID IS optional_feature_list END ';'</span><br><span class="line">    { $$ = class_($2, $4, $6, stringtable.add_string(curr_filename)); }</span><br></pre></td></tr></tbody></table></figure>
<p>该构造函数会用四个参数作为子节点构建一个 <code>Class_</code> 树节点。由于参数类型已声明，<strong>C++</strong> 类型检查器会强制确保仅将构造函数用于适当类型的参数。</p>
<p>在阅读代码时需要注意：相同的名称在不同上下文中可能表示不同实体。例如：</p>
<ul>
<li><code>CLASS</code>：终端符号  </li>
<li><code>class</code>：非终端符号  </li>
<li><code>class_</code>：构造器  </li>
<li><code>Class_</code>：门类</li>
</ul>
<p>它们的含义完全不同。此外，在 <code>cool.y</code> 的联合声明中还有 <code>class_</code> 成员，含义又不同。大多数情况可通过大小写区分，但并非总是如此，因此阅读代码时需特别注意每个符号的角色。</p>
<h3 id="AST-列表"><a href="#AST-列表" class="headerlink" title="AST 列表"></a>AST 列表</h3><p>对每个普通门类 <code>X</code>，APS 都会对应地定义一个列表门类 <code>Xs</code>，其类型为 <code>List [X]</code>（除了 <code>Classes</code> 是 <code>Class_</code> 的列表）。APS 为列表型门类提供了一组专用的操作，用于构建和访问列表结构。常用列表操作函数有：<br>| 函数名                | 功能说明                     |<br>|——————————-|—————————————-|<br>| <code>nil_Classes()</code>       | 返回一个空的 <code>Classes</code> 列表         |<br>| <code>single_Classes(Class_)</code> | 根据单个 <code>Class_</code> 元素创建长度为1的列表 |<br>| <code>append_Classes(Classes, Classes)</code> | 拼接两个 <code>Classes</code> 列表             |<br>| <code>Class_nth(int index)</code>    | 选取列表中第 <code>index</code> 个元素          |<br>| <code>int len()</code>           | 返回列表长度                   |</p>
<p>列表还提供了一个简单的迭代器，包含以下方法：</p>
<ul>
<li><code>first()</code>：返回列表第一个元素的索引  </li>
<li><code>more(index)</code>：当 <code>index</code> 不是最后一个元素时返回 <code>true</code>，否则返回 <code>false</code>  </li>
<li><code>next(index)</code>：返回列表中 <code>index</code> 的下一个元素的索引</li>
</ul>
<h3 id="AST-类层次结构"><a href="#AST-类层次结构" class="headerlink" title="AST 类层次结构"></a>AST 类层次结构</h3><p>Cool 的 AST 采用面向对象的类继承机制组织节点类型，整体结构如下：</p>
<ul>
<li>除列表外，所有 AST 类均派生自基类 <code>tree_node</code>。  </li>
<li>所有列表都是 <code>tree_node</code> 类型的列表。  </li>
<li><code>tree_node</code> 类及 AST 列表模板定义在 <code>tree.h</code> 中。</li>
</ul>
<h4 id="tree-node-类"><a href="#tree-node-类" class="headerlink" title="tree_node 类"></a><code>tree_node</code> 类</h4><ul>
<li>定义了抽象语法树节点所需的基本信息，除去特定构造函数特有的数据。  </li>
<li>包含受保护成员 <code>line_number</code>，表示该 AST 节点对应的源代码行号，用于编译器生成精准的错误提示信息。  </li>
<li>提供的重要成员函数包括：  <ul>
<li><code>dump</code>：以 pret 格式打印 AST。  </li>
<li><code>get_line_number</code>：访问节点对应的行号。</li>
</ul>
</li>
</ul>
<h4 id="门类"><a href="#门类" class="headerlink" title="门类"></a>门类</h4><ul>
<li>每个门类是直接从 <code>tree_node</code> 派生的类。  </li>
<li>门类的主要作用是将相关构造函数归类，不增加额外功能。</li>
</ul>
<h4 id="构造器类"><a href="#构造器类" class="headerlink" title="构造器类"></a>构造器类</h4><ul>
<li>每个构造器类都派生自对应的门类。  </li>
<li>每个构造器类定义了一个同名函数，用于构建对应的 AST 节点。  </li>
<li>构造器类自动定义了 <code>dump</code> 函数，用于打印节点信息。</li>
</ul>
<h3 id="AST-构造器类属性"><a href="#AST-构造器类属性" class="headerlink" title="AST 构造器类属性"></a>AST 构造器类属性</h3><p>tree 包中每个类定义都包含若干属性。每个构造器类都会为其组成部分定义对应的属性，属性名称与构造器中的字段名一致，且仅对该构造器类及其派生类的成员函数可见。例如，<code>class_constructor</code> 类具有以下四个属性：</p>
<ul>
<li><code>Symbol name;</code></li>
<li><code>Symbol parent;</code></li>
<li><code>Features features;</code></li>
<li><code>Symbol filename;</code></li>
</ul>
<p>为 AST 类添加成员函数能够有效提升代码可读性和开发效率。所有扩展均可通过直接编辑 <code>cool-tree.h</code> 等头文件完成，无需修改自动生成的 APS 定义。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><blockquote>
<p>在开始之前，建议先阅读 <code>handouts/cool-manual</code> 的第十一、十二节，分别详细介绍了 Cool 的优先级与语法结构。同时，推荐仔细阅读 <code>cool-tree.asp</code> 文件，其中定义了所有可用的构造器。</p>
</blockquote>
<p>我们先根据优先级和属性确定各个非终结符储存的字段和各个符号的优先级：<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">%type &lt;program&gt; program</span><br><span class="line">%type &lt;classes&gt; class_list</span><br><span class="line">%type &lt;class_&gt; class</span><br><span class="line"></span><br><span class="line">%type &lt;feature&gt; feature</span><br><span class="line">%type &lt;features&gt; dummy_feature_list</span><br><span class="line"></span><br><span class="line">%type &lt;formal&gt; formal</span><br><span class="line">%type &lt;formals&gt; formal_list</span><br><span class="line"></span><br><span class="line">%type &lt;case_&gt; branch</span><br><span class="line">%type &lt;cases&gt; branch_list</span><br><span class="line"></span><br><span class="line">%type &lt;expression&gt; expr dispatch static_dispatch let_expr let_cond case_expr</span><br><span class="line">%type &lt;expressions&gt; expr_list actual</span><br><span class="line"></span><br><span class="line">%right ASSIGN</span><br><span class="line">%left NOT</span><br><span class="line">%nonassoc LE '&lt;' '='</span><br><span class="line">%left '+' '-'</span><br><span class="line">%left '*' '/'</span><br><span class="line">%left ISVOID</span><br><span class="line">%left '~'</span><br><span class="line">%left '@'</span><br><span class="line">%left '.'</span><br><span class="line">%nonassoc LET</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>然后根据语法结构对应的 AST 的构造函数来写就行，然后根据错误要求处理一下错误就行：<br></p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line">program :</span><br><span class="line">  class_list</span><br><span class="line">    { SET_NODELOC(@1); ast_root = program($1); }</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">class_list :</span><br><span class="line">    class</span><br><span class="line">        { $$ = single_Classes($1);</span><br><span class="line">        parse_results = $$; }</span><br><span class="line">    | class_list class</span><br><span class="line">        { $$ = append_Classes($1, single_Classes($2));</span><br><span class="line">        parse_results = $$; }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">class :</span><br><span class="line">    CLASS TYPEID '{' dummy_feature_list '}' ';'</span><br><span class="line">        { $$ = class_($2, idtable.add_string("Object"), $4,</span><br><span class="line">                    stringtable.add_string(curr_filename)); }</span><br><span class="line">    | CLASS TYPEID INHERITS TYPEID '{' dummy_feature_list '}' ';'</span><br><span class="line">        { $$ = class_($2, $4, $6, stringtable.add_string(curr_filename)); }</span><br><span class="line">    | error</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">dummy_feature_list :</span><br><span class="line">    { $$ = nil_Features(); }</span><br><span class="line">    | feature ';'</span><br><span class="line">        { $$ = single_Features($1); }</span><br><span class="line">    | dummy_feature_list feature ';'</span><br><span class="line">        { $$ = append_Features($1, single_Features($2)); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">feature :</span><br><span class="line">    OBJECTID ':' TYPEID</span><br><span class="line">        { $$ = attr($1, $3, no_expr()); }</span><br><span class="line">    | OBJECTID ':' TYPEID ASSIGN expr</span><br><span class="line">        { $$ = attr($1, $3, $5); }</span><br><span class="line">    | OBJECTID '(' ')' ':' TYPEID '{' expr '}'</span><br><span class="line">        { $$ = method($1, nil_Formals(), $5, $7); }</span><br><span class="line">    | OBJECTID '(' formal_list ')' ':' TYPEID '{' expr '}'</span><br><span class="line">        { $$ = method($1, $3, $6, $8); }</span><br><span class="line">    | error</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">formal_list :</span><br><span class="line">    { $$ = nil_Formals(); }</span><br><span class="line">    | formal</span><br><span class="line">        { $$ = single_Formals($1); }</span><br><span class="line">    | formal_list ',' formal</span><br><span class="line">        { $$ = append_Formals($1, single_Formals($3)); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">formal :</span><br><span class="line">    OBJECTID ':' TYPEID</span><br><span class="line">        { $$ = formal($1, $3); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">branch_list :</span><br><span class="line">    { $$ = nil_Cases(); }</span><br><span class="line">    | branch</span><br><span class="line">        { $$ = single_Cases($1); }</span><br><span class="line">    | branch_list branch</span><br><span class="line">        { $$ = append_Cases($1, single_Cases($2)); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">branch :</span><br><span class="line">    OBJECTID ':' TYPEID DARROW expr ';'</span><br><span class="line">        { $$ = branch($1, $3, $5); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">expr :</span><br><span class="line">    OBJECTID ASSIGN expr</span><br><span class="line">        { $$ = assign($1, $3); }</span><br><span class="line">    | dispatch</span><br><span class="line">    | static_dispatch</span><br><span class="line">    | IF expr THEN expr ELSE expr FI</span><br><span class="line">        { $$ = cond($2, $4, $6); }</span><br><span class="line">    | WHILE expr LOOP expr POOL</span><br><span class="line">        { $$ = loop($2, $4); }</span><br><span class="line">    | WHILE expr LOOP error</span><br><span class="line">    | '{' expr_list '}'</span><br><span class="line">        { $$ = block($2); }</span><br><span class="line">    | let_expr</span><br><span class="line">    | case_expr</span><br><span class="line">    | NEW TYPEID</span><br><span class="line">        { $$ = new_($2); }</span><br><span class="line">    | ISVOID expr</span><br><span class="line">        { $$ = isvoid($2); }</span><br><span class="line">    | expr '+' expr</span><br><span class="line">        { $$ = plus($1, $3); }</span><br><span class="line">    | expr '-' expr</span><br><span class="line">        { $$ = sub($1, $3); }</span><br><span class="line">    | expr '*' expr</span><br><span class="line">        { $$ = mul($1, $3); }</span><br><span class="line">    | expr '/' expr</span><br><span class="line">        { $$ = divide($1, $3); }</span><br><span class="line">    | '~' expr</span><br><span class="line">        { $$ = neg($2); }</span><br><span class="line">    | expr '&lt;' expr</span><br><span class="line">        { $$ = lt($1, $3); }</span><br><span class="line">    | expr LE expr</span><br><span class="line">        { $$ = leq($1, $3); }</span><br><span class="line">    | expr '=' expr</span><br><span class="line">        { $$ = eq($1, $3); }</span><br><span class="line">    | NOT expr</span><br><span class="line">        { $$ = comp($2); }</span><br><span class="line">    | '(' expr ')'</span><br><span class="line">        { $$ = $2; }</span><br><span class="line">    | OBJECTID</span><br><span class="line">        { $$ = object($1); }</span><br><span class="line">    | INT_CONST</span><br><span class="line">        { $$ = int_const($1); }</span><br><span class="line">    | STR_CONST</span><br><span class="line">        { $$ = string_const($1); }</span><br><span class="line">    | BOOL_CONST</span><br><span class="line">        { $$ = bool_const($1); }</span><br><span class="line">    | error</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">dispatch :</span><br><span class="line">    OBJECTID '(' actual ')'</span><br><span class="line">        { $$ = dispatch(object(idtable.add_string("self")), $1, $3); }</span><br><span class="line">    | expr '.' OBJECTID '(' actual ')'</span><br><span class="line">        { $$ = dispatch($1, $3, $5); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">static_dispatch :</span><br><span class="line">    expr '@' TYPEID '.' OBJECTID '(' actual ')'</span><br><span class="line">        { $$ = static_dispatch($1, $3, $5, $7); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">actual :</span><br><span class="line">    { $$ = nil_Expressions(); }</span><br><span class="line">    | expr</span><br><span class="line">        { $$ = single_Expressions($1); }</span><br><span class="line">    | actual ',' expr</span><br><span class="line">        { $$ = append_Expressions($1, single_Expressions($3)); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">expr_list :</span><br><span class="line">    expr ';'</span><br><span class="line">        { $$ = single_Expressions($1); }</span><br><span class="line">    | expr_list expr ';'</span><br><span class="line">        { $$ = append_Expressions($1, single_Expressions($2)); }</span><br><span class="line">    | error</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">let_expr :</span><br><span class="line">    LET OBJECTID ':' TYPEID IN expr</span><br><span class="line">        { $$ = let($2, $4, no_expr(), $6); }</span><br><span class="line">    | LET OBJECTID ':' TYPEID ASSIGN expr IN expr</span><br><span class="line">        { $$ = let($2, $4, $6, $8); }</span><br><span class="line">    | LET OBJECTID ':' TYPEID ',' let_cond</span><br><span class="line">        { $$ = let($2, $4, no_expr(), $6); }</span><br><span class="line">    | LET OBJECTID ':' TYPEID ASSIGN expr ',' let_cond</span><br><span class="line">        { $$ = let($2, $4, $6, $8); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">let_cond :</span><br><span class="line">    OBJECTID ':' TYPEID IN expr</span><br><span class="line">        { $$ = let($1, $3, no_expr(), $5); }</span><br><span class="line">    | OBJECTID ':' TYPEID ASSIGN expr IN expr</span><br><span class="line">        { $$ = let($1, $3, $5, $7); }</span><br><span class="line">    | OBJECTID ':' TYPEID ',' let_cond</span><br><span class="line">        { $$ = let($1, $3, no_expr(), $5); }</span><br><span class="line">    | OBJECTID ':' TYPEID ASSIGN expr ',' let_cond</span><br><span class="line">        { $$ = let($1, $3, $5, $7); }</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">case_expr :</span><br><span class="line">    CASE expr OF branch_list ESAC</span><br><span class="line">        { $$ = typcase($2, $4); }</span><br><span class="line">    ;</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>不知道为啥评测程序好像有 bug……我无论是换谁的程序都判不出来。嗯，所以我找了份大佬的程序对拍，拍过了(<em>^_^</em>)</p>
<p>哦，现在我知道了，原来是它用的脚本跟我的 Shell 不匹配……把 <code>grading</code> 目录下的 <code>myparser</code> 的 <code>csh</code> 也改成 <code>bash</code> 就行了</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>PA3 同样很简单，有一堆只要了解接口的东西要看，但都不是很复杂。有一说一，过于自动化的程序导致了课程内容与作业略有一点脱节，课上讲的解析器原理在作业中完全没有体现，有一点遗憾，不过后面的作业应该会好很多。</p>
<p>现在可以贴通关截图哩：</p>
<figure style="text-align: center;">
  <img src="/illustrations/CS143-PA/PA3.png" alt="通关截图" width="100%">
  <figcaption>通关截图</figcaption>
</figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://restar682.github.io">restar682</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://restar682.github.io/2025/08/10/CS143-PA3%EF%BC%9AParsing/">http://restar682.github.io/2025/08/10/CS143-PA3%EF%BC%9AParsing/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客文章版权归 restar682 所有，采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明原作者！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a><a class="post-meta__tags" href="/tags/CS143/">CS143</a><a class="post-meta__tags" href="/tags/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90/">语法分析</a><a class="post-meta__tags" href="/tags/%E6%8A%BD%E8%B1%A1%E8%AF%AD%E6%B3%95%E6%A0%91/">抽象语法树</a></div><div class="post-share"><div class="social-share" data-image="/img/head-sculpture.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/06/Hexo-%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F%E7%9A%84%E8%BD%AC%E4%B9%89-BUG/" title="Hexo 数学公式的转义 BUG"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">Hexo 数学公式的转义 BUG</div></div><div class="info-2"><div class="info-item-1">我的评价是：二次转义导致的。</div></div></div></a><a class="pagination-related" href="/2025/08/12/CS143-Week5%EF%BC%9ASemantic-Analysis-and-Type-Checking/" title="CS143-Week5：Semantic Analysis and Type Checking"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">CS143-Week5：Semantic Analysis and Type Checking</div></div><div class="info-2"><div class="info-item-1">语义分析基础及类型系统的形式化定义与类型检查方法。</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/08/04/CS143-Week3%EF%BC%9AParsing-Top-Down-Parsing/" title="CS143-Week3：Parsing &amp; Top-Down Parsing"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-04</div><div class="info-item-2">CS143-Week3：Parsing &amp; Top-Down Parsing</div></div><div class="info-2"><div class="info-item-1">语法分析的目标、文法基础与递归下降解析技术。</div></div></div></a><a class="pagination-related" href="/2025/08/06/CS143-Week4%EF%BC%9ABottom-Up-Parsing/" title="CS143-Week4：Bottom-Up Parsing"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-08-06</div><div class="info-item-2">CS143-Week4：Bottom-Up Parsing</div></div><div class="info-2"><div class="info-item-1">预测解析与自底向上解析。</div></div></div></a><a class="pagination-related" href="/2025/07/27/CS143-Week1%EF%BC%9AIntroduction/" title="CS143-Week1：Introduction"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-27</div><div class="info-item-2">CS143-Week1：Introduction</div></div><div class="info-2"><div class="info-item-1">编译器的简单介绍和 Cool 语言。</div></div></div></a><a class="pagination-related" href="/2025/07/26/CS143-Week0%EF%BC%9A%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/" title="CS143-Week0：实验环境配置"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-26</div><div class="info-item-2">CS143-Week0：实验环境配置</div></div><div class="info-2"><div class="info-item-1">CS143 环境配置。</div></div></div></a><a class="pagination-related" href="/2025/07/30/CS143-PA1%EF%BC%9ACool-Language/" title="CS143-PA1：Cool-Language"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-30</div><div class="info-item-2">CS143-PA1：Cool-Language</div></div><div class="info-2"><div class="info-item-1">CS143 PA1：实现 Cool 语言的一个栈机器</div></div></div></a><a class="pagination-related" href="/2025/07/30/CS143-Week2%EF%BC%9ALexical-Analysis-Finite-Automata/" title="CS143-Week2：Lexical Analysis &amp; Finite Automata"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-30</div><div class="info-item-2">CS143-Week2：Lexical Analysis &amp; Finite Automata</div></div><div class="info-2"><div class="info-item-1">词法分析的原理与实现。</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head-sculpture.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">restar682</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">64</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">65</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/restar682"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">this is my blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">语法分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.1.</span> <span class="toc-text">准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bison-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.</span> <span class="toc-text">Bison 简单介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">文件结构概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-definitions%EF%BC%88%E5%AE%9A%E4%B9%89%E5%8C%BA%EF%BC%89"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1. definitions（定义区）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-rules%EF%BC%88%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99%E5%8C%BA%EF%BC%89"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2. rules（语法规则区）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.2.1.2.1.</span> <span class="toc-text">示例：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">1.2.1.2.2.</span> <span class="toc-text">重要规则：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-user-code%EF%BC%88%E7%94%A8%E6%88%B7%E4%BB%A3%E7%A0%81%E5%8C%BA%EF%BC%89"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">3. user code（用户代码区）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E4%B8%8E%E8%AF%AD%E4%B9%89%E5%80%BC"><span class="toc-number">1.2.2.</span> <span class="toc-text">属性与语义值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.2.3.</span> <span class="toc-text">错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">基本原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Cool-%E8%AF%AD%E8%A8%80%E7%9A%84-AST-%E5%8C%85"><span class="toc-number">1.3.</span> <span class="toc-text">Cool 语言的 AST 包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#APS-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">APS 简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AST-%E5%88%97%E8%A1%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">AST 列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AST-%E7%B1%BB%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.3.</span> <span class="toc-text">AST 类层次结构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tree-node-%E7%B1%BB"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">tree_node 类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%A8%E7%B1%BB"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">门类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8%E7%B1%BB"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">构造器类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AST-%E6%9E%84%E9%80%A0%E5%99%A8%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">1.3.4.</span> <span class="toc-text">AST 构造器类属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.4.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.</span> <span class="toc-text">小结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/12/k%E5%A4%A7%E6%9E%84%E6%88%90L7/" title="k大构成L7">k大构成L7</a><time datetime="2025-12-12T02:16:22.000Z" title="发表于 2025-12-12 10:16:22">2025-12-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/11/k%E5%A4%A7%E6%9E%84%E6%88%90L6/" title="k大构成L6">k大构成L6</a><time datetime="2025-12-11T07:11:24.000Z" title="发表于 2025-12-11 15:11:24">2025-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/07/k%E5%A4%A7%E6%9E%84%E6%88%90L5/" title="k大构成L5">k大构成L5</a><time datetime="2025-12-07T07:38:14.000Z" title="发表于 2025-12-07 15:38:14">2025-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/07/k%E5%A4%A7%E6%9E%84%E6%88%90L4/" title="k大构成L4">k大构成L4</a><time datetime="2025-12-07T01:45:23.000Z" title="发表于 2025-12-07 09:45:23">2025-12-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/12/06/k%E5%A4%A7%E6%9E%84%E6%88%90L3/" title="k大构成L3">k大构成L3</a><time datetime="2025-12-06T12:22:18.000Z" title="发表于 2025-12-06 20:22:18">2025-12-06</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By restar682</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --><script data-pjax="">
    function butterfly_categories_card_injector_config(){
      var parent_div_git = document.getElementById('recent-posts');
      var item_html = '<style>li.categoryBar-list-item{width:32.3%;}.categoryBar-list{max-height: 190px;overflow:auto;}.categoryBar-list::-webkit-scrollbar{width:0!important}@media screen and (max-width: 650px){.categoryBar-list{max-height: 160px;}}</style><div class="recent-post-item" style="height:auto;width:100%;padding:0px;"><div id="categoryBar"><ul class="categoryBar-list"><li class="categoryBar-list-item" style="background:url(/images/4.jpg);"> <a class="categoryBar-list-link" href="categories/6-s081/">6.s081</a><span class="categoryBar-list-count">12</span><span class="categoryBar-list-descr">6.s081</span></li><li class="categoryBar-list-item" style="background:url(/images/5.jpg);"> <a class="categoryBar-list-link" href="categories/DEBUG/">DEBUG</a><span class="categoryBar-list-count">4</span><span class="categoryBar-list-descr">CS143</span></li><li class="categoryBar-list-item" style="background:url(/images/6.jpg);"> <a class="categoryBar-list-link" href="categories/工具/">工具</a><span class="categoryBar-list-count">5</span><span class="categoryBar-list-descr">DEBUG</span></li><li class="categoryBar-list-item" style="background:url(/images/7.jpg);"> <a class="categoryBar-list-link" href="categories/绘画/">绘画</a><span class="categoryBar-list-count">16</span><span class="categoryBar-list-descr">UCAS-nlp</span></li><li class="categoryBar-list-item" style="background:url(/images/8.jpg);"> <a class="categoryBar-list-link" href="categories/CS143/">CS143</a><span class="categoryBar-list-count">15</span><span class="categoryBar-list-descr">工具</span></li><li class="categoryBar-list-item" style="background:url(/images/9.jpg);"> <a class="categoryBar-list-link" href="categories/UCAS-nlp/">UCAS-nlp</a><span class="categoryBar-list-count">5</span><span class="categoryBar-list-descr">绘画</span></li><li class="categoryBar-list-item" style="background:url(/images/11.jpeg);"> <a class="categoryBar-list-link" href="categories/计网/">计网</a><span class="categoryBar-list-count">7</span><span class="categoryBar-list-descr">计网</span></li></ul></div></div>';
      console.log('已挂载butterfly_categories_card')
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      }
    if( document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    butterfly_categories_card_injector_config()
    }
  </script><!-- hexo injector body_end end --></body></html>
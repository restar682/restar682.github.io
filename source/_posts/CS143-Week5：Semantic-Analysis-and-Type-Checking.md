---
title: CS143-Week5：Semantic Analysis and Type Checking
date: 2025-08-12 19:03:08
categories: CS143
description: 
tags: [编译原理, Linux, CS143, 语义分析]
---
# 语义分析基础
## 检查
Coolc 会执行多种类型检查：
1. 所有标识符均已在当前可见的作用域内声明
2. 类型检查
3. 继承关系合法
4. 类只能定义一次
5. 类中的方法只能定义一次
6. 保留标识符未被滥用
   以及其他检查……

## 作用域
### 作用域的定义与匹配

**作用域**（Scope）是指一个声明在程序中可见并可被访问的代码范围。

在语义分析中，我们会根据作用域，将标识符的使用与其对应的声明进行匹配。

### 静态作用域与动态作用域

- **静态作用域**（Static Scoping）
  由程序的文本结构决定，与程序运行时的行为无关。
  大多数编程语言（包括 Cool）都采用静态作用域。

- **动态作用域**（Dynamic Scoping）
  由程序运行时的调用栈决定，与代码的书写结构无关。
  早期的 Lisp 和 SNOBOL 使用动态作用域，但许多语言（如 Lisp）后来转向以静态作用域为主。

### Cool 中引入标识符绑定的语法结构

在 Cool 语言中，以下语法结构会引入新的标识符绑定：

- **类声明**：引入类名
- **方法定义**：引入方法名
- **Let 表达式**：引入对象标识符
- **形式参数**：引入对象标识符
- **属性定义**：引入对象标识符
- **Case 表达式**：引入对象标识符

## 语义分析基本流程
大多数语义分析（如检查变量是否声明、类型是否匹配）通常通过**递归遍历抽象语法树（AST）**来完成。

常用的遍历方式是“边向下走，边处理”，一般分为三个步骤：

1. 先处理当前节点的一部分  
   例如，当遇到类或方法时，先将它的名字记录到符号表中，以便后续查找。  

2. 再处理子节点  
   递归地处理内部的语句或表达式，例如依次分析函数体中的每一行代码。  

3. 最后处理剩余工作并返回  
   比如检查函数返回值类型是否正确，或清理作用域（退出函数后，局部变量不再可用）。

## 符号表
---
title: CS143-Week3：Parsing & Top-Down Parsing
date: 2025-08-04 07:57:38
categories: CS143
description: 
tags: [编译原理, Linux, CS143, 语法分析, 语法分析树, 抽象语法树]
---
# 
## 简介
语法分析的主要目标是：
- **判定有效性并构建语法树：** 判断输入的 Token 序列是否符合源语言的语法规则（即是否为一个有效的句子）。如果有效，则成功构建出对应的语法分析树（Parse Tree）或抽象语法树（AST），为后续的语义分析和代码生成提供结构化基础。
- **鲁棒地处理语法错误：** 当输入序列存在语法错误时，能够以优雅地进行错误恢复，尽可能地继续分析后续代码，报告有意义的错误信息，并尝试构建部分正确的语法树，以提升编译器的用户体验和诊断能力。

事实上，有的编译器并不区分词法分析和语义分析，但大多数编译器仍然选择分开。因为正则表达式相当适合处理词法分析，解析过程再单独处理比较方便。

## 上下文无关文法
不是所有的 Token 序列都是程序，我们的语法分析需要能够识别有效的程序，并为无效的程序提供错误信息。因此，我们需要一种方法来识别有效的 Token 序列，并设计一种算法来区别有效和无效的 Token 序列。

在大多数编程语言中，语法结构通常具有递归性，例如一个表达式中可以嵌套另一个表达式，正则表达式的表达能力不足以对它进行处理。一方面，递归结构的次数是动态变化的，所需要的状态数也随之改变，正则表达不了这种动态可变的状态数；另一方面，递归可能会死循环，这更加超出了正则表达式的能力范围。因此，我们需要一种表达能力更强的形式化工具——上下文无关文法（Context-Free Grammars, CFGs），它能自然地描述递归结构。

### CFG 语法
CFG 包含四个组成部分：

1. **终结符号集合（Terminal symbols）**：文法中用于生成最终字符串的符号集合，通常记作 $T$。这些符号不会被进一步替换，例如字母、数字或标点符号。

2. **非终结符号集合（Non-terminal symbols）**：文法中的变量，用于表示语法结构，通常记作 $N$。它们可以被替换为终结符号或其他非终结符号的组合。

3. **开始符号（Start symbol）**：文法推导开始的非终结符，通常记作 $S \in N$。

4. **产生式规则集合（Production rules）**：一组替换规则，描述非终结符如何被替换为其他符号，通常形式为 $X \rightarrow Y_1,Y_2,\cdots,Y_n$，其中 $X \in N$，$Y_1,Y_2,\cdots,Y_n \in (N \cup T)^\*$。

### CFG 语言
设 $G$ 是一个以 $S$ 为起始符号的上下文无关文法。则 $G$ 所生成的语言 $L(G)$ 定义为：

<div align="center">
$ L(G) = \{ a_1 a_2 \cdots a_n \mid a_i \in T \cap S \Rightarrow^* a_1 a_2 \cdots a_n \} $
</div>

在编程语言中，这里的 $a_i$ 通常对应于 Token 的类型。对于一个编程语言的有效 Token 序列，需要满足以下两个核心要求：

1.  **可推导性 (Derivability):** 该 Token 序列必须能够从文法的起始符号 $S$ 开始，通过反复应用文法中的产生式规则推导出来。这确保了序列在语法结构上是正确的。
2.  **终结符合法性 (Terminal Validity):** 序列中的每一个元素（即每一个 Token）都必须属于该 CFG 预先定义的终结符集合。这保证了序列中的基本构成单元是语言所允许的。

### 推导
推导是指从文法的起始符号开始，通过依次应用一个或多个产生式规则，逐步将非终结符替换为其他符号序列，最终生成一个由终结符组成的字符串的过程。

这个推导过程可以直观地表示为一棵**语法分析树**（Parse Tree）。具体来说：
- 树的**根节点**对应起始符号。
- 当推导过程中应用一条产生式规则 $X \rightarrow Y_1,Y_2,\cdots,Y_n$ 来替换某个非终结符 $X$ 时，就在树中将 $X$ 作为**父节点**，并为其创建 $n$ 个**子节点**，依次对应规则右部的符号 $Y_1,Y_2,\cdots,Y_n$。

例如，表达式 $ID * ID + ID$ 的语法分析树如图所示：
<figure style="text-align: center; margin-top: 1em;">
  <img src="/illustrations/CS143-Week3/1.png" alt="语法分析树" width="80%">
  <figcaption>语法分析树</figcaption>
</figure>

虽然推导方式可能多种多样，但我们通常只关心最终生成的语法分析树是否相同，具体的推导过程并不重要。为了方便，我们一般使用最左推导或最右推导这两种标准方法。

### 歧义文法
如果一个文法对于某些句子能够生成多棵不同的语法分析树，那么该文法就是有歧义的。解决文法歧义的方法主要有两种：一是重写文法，从根本上消除歧义；二是允许歧义文法存在，通过引入运算符优先级和结合性规则，在语法分析时确定唯一的解析方式。

歧义并不一定是文法设计的缺陷。例如，通过引入运算符优先级和结合性规则来处理原本有歧义的结构，可以在保持文法简洁的同时，显著提升语言的易用性和表达的自然性。
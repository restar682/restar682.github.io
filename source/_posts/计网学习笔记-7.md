---
title: 计网学习笔记-7
date: 2025-11-29 17:31:07
categories: 计网
description: 《计算机网络——自顶向下方法》第七章学习笔记。
tags: [计算机网络, 无线网络, 移动网络]
---
# 无线网络和移动网络
从网络视角来看，无线通信与移动性毫无疑问地共同引入了有别于传统有线网络的一系列新挑战，尤其体现在链路层和网络层。因此，这部分内容有必要单独讨论。（其实是我确实很好奇啊 awa）

需要首先区分两个概念：**无线性**指通信链路通过无线电波建立，而非依赖物理线缆；**移动性**则指终端在网络中动态变更接入位置。两者并非必然同时出现，例如家用 Wi-Fi 下的台式机具备无线性却缺乏移动性，而用户携带笔记本从家到公司并改用有线网络时则具备移动性但不具备无线性。最复杂的情形无疑是二者的叠加情况，比如用户在高速移动的车辆中持续进行语音或数据通信。

本章将以这一交集为主线展开：首先介绍无线用户如何经由网络边缘的无线链路接入更大的（通常是有线的）网络基础设施；随后分析无线链路的特性，并简述蜂窝系统中广泛采用的码分多址（CDMA）。接着深入阐述 IEEE 802.11（Wi-Fi）的链路层机制，并概览蓝牙等个人域网技术；之后介绍 3G 与 4G/LTE 等蜂窝接入技术，它们统一支持语音与高速数据业务；再进一步讨论移动性管理，包括位置更新、路由维护与切换等核心问题；并说明企业 Wi-Fi 与 LTE 网络中如何利用移动 IP 来实现无缝移动服务。最后，本章将探讨无线性和移动性对传输层协议（如 TCP）以及实时视频等网络应用的影响。

通过以上内容，我们将整体理解无线与移动网络的核心运行原理，以及它们在设计上面临的主要挑战。

## 概述
本章讨论的无线与移动网络场景涵盖了从 Wi-Fi 到 4G 在内的多种技术。为了建立一致的理解，我们首先引入几个关键概念：

- **无线主机**：运行应用的端系统设备，如手机、笔记本、平板或嵌入式设备。它可以是静止的，也可以移动。  
- **无线链路**：主机通过**无线通信链路**与基站或其他设备通信的通道。不同技术（如 Wi-Fi、蜂窝）在速率和覆盖范围上差异很大，且性能受距离、干扰和用户数量影响。  
- **基站**：无线网络中的核心基础设施，在有线网络中没有直接对应设备。它负责与主机进行无线通信，接收数据并将其接入更大的网络（如互联网），同时负责协调其覆盖区域内主机的传输。典型例子包括蜂窝网络的**蜂窝塔**以及无线局域网中的**接入点**（Access Point, AP）。
- **网络基础设施**：指无线主机最终要访问的更大网络，如因特网或企业内网。

当主机位于基站覆盖范围内，并通过基站接入网络时，被称作以**基础设施模式**运行。在这种模式下，所有地址分配、路由等传统的网络服务都由网络基础设施统一提供。另一种通信方式是**自组织网络**（ad hoc），在这种网络中，没有基站存在，主机之间直接通信，必须自行完成路由、地址配置、类似 DNS 的域名转换等功能。

当移动主机从一个基站覆盖区进入另一个时，需要**切换**到新的基站。由此产生了一系列挑战，包括如何定位移动设备、如何为其分配地址，以及如何在移动过程中保持 TCP 连接或语音通话的连续性。

根据无线通信是单跳还是多跳，以及网络中是否存在基站等基础设施，可将无线网络划分为四类：

1. **单跳，基于基础设施**：  
   主机通过一个无线跳与基站通信，基站再连入有线网络。  
   **典型代表**：家庭/办公室 Wi-Fi、4G/5G 蜂窝网络。这是最常见、最主流的类型。

2. **单跳，无基础设施**：  
   无基站，主机直接通信，但通常由其中一个设备协调（如蓝牙主从模式）。  
   **典型代表**：蓝牙耳机、键盘，或 Wi-Fi 直连（自组织模式）。

3. **多跳，基于基础设施**：  
   主机通过多个无线节点中继，最终到达有线连接的基站。  
   **典型代表**：无线网状网络、某些传感网络。

4. **多跳，无基础设施**：  
   无基站，通信需经多个移动节点中继。  
   **典型代表**：移动自组织网络（MANET）、车联网（VANET）。这类网络协议设计复杂，仍在研究中。

## 无线链路和网络特征
如果用无线 802.11 网络替换有线以太网，也就是让无线网络接口取代有线以太网接口、让 AP 取代交换机，那么在网络层及以上几乎不需要做任何调整。这说明，有线与无线网络之间最核心的差异主要体现在链路层。

无线链路与有线链路相比，面临几个特有的挑战：

- **信号衰减**：电磁波在传播过程中会因距离增加而减弱（称为路径损耗），穿墙或障碍物时还会进一步衰减。  
- **干扰**：多个设备若使用相同频段（如 2.4 GHz 的 Wi-Fi 与无线电话），会相互干扰；此外，微波炉、电机等电器也会产生电磁噪声。  
- **多径传播**：信号经不同路径（如反射、绕射）到达接收端，导致波形叠加失真，且随环境变化而动态改变。

这些因素使得**无线链路的比特错误率显著高于有线链路**。因此，无线协议（如 802.11）不仅使用强效的 CRC 进行差错检测，还引入**链路层 ARQ 机制**，对出错的帧进行自动重传。

考虑了噪声后，可以知道接收端收到的信号是原始信号的退化版本与环境噪声的混合。衡量信号质量的关键指标是**信噪比**（Signal-to-Noise Ratio, SNR），也即所收到的信号和噪声强度的相对测量。SNR 越高，接收方越容易从噪声中正确恢复数据。

虽然不同的调制方式（如 BPSK、QAM）和编码策略会影响传输效果，但在相同调制条件下，SNR 越高，**比特差错率**（BER）就越低这一规律始终成立。发送方可以通过提高发射功率来提升 SNR，从而降低误码率并增强可靠性，但功率带来的收益并非无限增长。当 BER 已经非常低（例如从 $10^{-12}$ 再降到 $10^{-13}$）时，继续增大发射功率带来的改善几乎可以忽略不计，反而会引发额外问题，例如移动设备能耗升高，以及更强信号导致的无线干扰加剧。

此外，调制方式的选择也需要在速率与可靠性之间进行权衡。在相同的 SNR 下，高速调制方式（如 QAM16）通常会比低速调制方式更容易出错。例如，在 SNR 为 10 dB 时，低速的 BPSK 可以保持极低的误码率，而高速的 QAM16 误码率可能高到无法应用；但当 SNR 提升到 20 dB 时，QAM16 就能够在可接受的误码率下工作，从而提供更高的吞吐量。

因此，现代无线系统（如 Wi-Fi 和 4G/5G）普遍采用**自适应调制与编码**（AMC），根据实时信道状况（如 SNR）动态选择合适的调制方式和编码率，在保证误码率满足要求的同时尽可能提高传输速率。

除了更高且随时间变化的误码率外，无线链路还面临有线网络所没有的另一类挑战，就是多路访问更加复杂。在有线广播网络中，所有节点都能清晰地“听到”彼此的传输，因而容易进行协调；而在无线环境中，由于**隐藏终端问题**和**信号衰减**的存在，节点往往无法准确判断其他节点的发送情况，使得多路访问控制变得更加困难。

- **隐藏终端问题**：两个发送方（A 和 C）彼此无法侦听到对方，却同时向同一个接收方（B）发送，导致在 B 处发生碰撞，而 A 和 C 并不知道冲突发生；  
- **信号衰减**：即使 A 和 C 距离不远，其信号在传播中可能已衰减到无法被对方检测，但仍足以在接收端相互干扰。

这些现象使得无线网络中的碰撞更难避免和检测，因此其多路访问机制（如 802.11 的 RTS/CTS）比有线网络复杂得多。

### CDMA
在上一章中我们提到，当多个设备共享同一通信媒介时，需要多路访问协议来避免彼此干扰。CDMA 的做法是为每个发送方分配一个独特的编码序列。所有用户可以同时占用整个频带，但各自通过不同的码对数据进行标记，从而在接收端得以区分。

在 CDMA 中，每个待发送的数据比特都会被扩展成一串速率更高的“码片”，这一过程称为**扩频**。其基本做法是使用预先分配的、独特的编码序列去调制原始数据比特，使不同用户的比特在同一频带中以各自的码片序列区分开来。用于调制的编码序列变化得非常快，其变化速率（即**码片速率**）远高于原始比特序列的变化速率。

假设一个数据比特持续一个比特时隙，并被划分为 $M$ 个码片时隙（如 $M=8$，实际系统中常更大）。发送方为每个比特分配一个由 $+1$ 和 $-1$ 组成的长度 $M$ 的编码向量。为便于数学处理，原始比特 0 映射为 $-1$，1 映射为 $+1$。发送时，将比特值与该编码向量逐分量相乘，即可得到包含 $M$ 个码片的发送向量，从而将低速比特流扩展为高速的码片序列。

在接收端，将收到的码片序列视为一个向量。接收方用和发送方相同的编码序列向量与该接收向量做内积并归一化，就能恢复出自身的原始比特。原因在于若不同用户的编码序列近似正交，则它们的向量内积接近于零。于是，在接收到的混合信号中，各用户信号相加可写为多个“编码向量的线性组合”。当接收方与自己的编码向量做内积时，只有对应项会产生非零的放大效果，其余用户的编码因正交而被抵消，从而实现同时发送、互不干扰的多址接入。

一个简单的 CDMA 例子如下图：
<figure style="text-align: center;">
<img src="/illustrations/计网笔记7/1.png" alt="简单的 CDMA 例子" width="70%">
<figcaption>简单的 CDMA 例子</figcaption>
</figure>

因此，CDMA 通过“编码划分”实现了多用户共享同一频段，其有效性依赖精心设计的正交编码和合理的功率控制。具体来说，首先编码设计要足够优良，使不同用户的信号在数学上可分离，其次要保证各信号到达接收端的强度相近，否则强信号可能淹没弱信号。而尽管实际部署中存在同步和功率控制等挑战，CDMA 的优势在于**频谱利用率高、抗干扰能力强**，特别适合无线环境，因此成为早期 3G 蜂窝系统的核心技术之一。

## WiFi：802.11 无线 LAN
如今，无线局域网（WLAN）已无处不在，无论是办公室、家庭、校园、机场，还是街头，都能看到它的身影，成为互联网接入的重要方式。在众多早期标准中，**IEEE 802.11**（即 Wi-Fi）最终脱颖而出，成为主流。

尽管 802.11 协议族包含多个版本，但它们共享几个关键特性：  
- 使用相同的**链路层帧结构**；  
- 采用统一的**媒体访问控制协议**（CSMA/CA，稍后详述）；  
- 支持**速率自适应**：信号弱时自动降低速率以延长传输距离；  
- **向后兼容**：老设备（如仅支持 802.11g 的手机）仍能与新基站（如 802.11ac）通信。

它们的主要差异体现在**物理层**，尤其是工作频段和速率。2.4 GHz 频段（2.4–2.485 GHz）无需授权，覆盖范围较广，但易受微波炉、蓝牙等设备干扰；5 GHz 频段（5.1–5.8 GHz）干扰少、速率高，但穿墙能力弱，传输距离较短。较新的标准如 **802.11n** 和 **802.11ac** 引入了**多输入多输出**（MIMO）技术，通过多个天线同时收发不同数据流显著提升吞吐量和可靠性。802.11ac 还支持**多用户 MIMO**和**波束成形**，能够将信号能量集中指向目标设备，减少干扰并增强覆盖。

需要注意的是，标称速率（如 1300 Mbps）是在理想环境下测得的，例如在近距离且无干扰的条件下。实际使用中，速率通常远低于标称值。

总体而言，802.11 通过统一架构、平滑演进和强大兼容性，奠定了其在无线接入领域的主导地位。

### 802.11 体系结构
802.11 无线局域网的基本组成单元是**基本服务集**（Basic Service Set, BSS），一个 BSS 包含一个或多个无线设备（如手机、笔记本）和一个**接入点**（Access Point, AP）。在 802.11 网络中，AP 相当于无线网络的**基站**，负责协调各设备的通信并接入更大的网络。AP 通常通过有线网络（如以太网交换机或路由器）连接到互联网，在家庭环境中，AP 与路由器常被集成在同一设备中。

和以太网一样，每个 802.11 无线站点和 AP 的无线接口都拥有一个 6 字节的 MAC 地址，同样由 IEEE 统一分配，理论上全球唯一。

这种由 AP 和有线基础设施支撑的网络称为**基础设施模式无线 LAN**，是最常见的 Wi-Fi 部署方式。802.11 也支持**自组织网络**（ad hoc mode），在这种模式下，无线设备之间可以直接通信，无需 AP 或外部网络，例如会议室中几台笔记本临时组网共享文件。尽管自组织网络在特定场景下有其用途，本节将重点讨论**基础设施模式**的无线 LAN。

在基础设施模式下运行的 802.11 网络中，无线设备（如手机或笔记本）必须先与 AP 建立连接才能收发网络数据。网络管理员在部署 AP 时，会为其配置两个关键参数，确保网络正常运行和高效管理：

- **服务集标识符**（SSID）：网络名称，例如 “HomeWiFi” 或 “Cafe_Guest”；  
- **信道号**：在 2.4 GHz 频段（2.4–2.4835 GHz）中，共有 11 个信道，但只有 **信道 1、6、11** 互不重叠，因此在部署多个 AP 时通常选用这三个信道，以减少相互干扰。

当用户进入一个“**Wi-Fi 丛林**”（即多个 AP 信号重叠的区域，如城市咖啡馆），设备需要从中选择一个 AP 进行关联。关联后，设备的所有通信都通过该 AP 转发，其他 AP 不会为其提供服务。

在 802.11 网络中，无线设备通过扫描可用信号来发现附近的 AP。每个 AP 定期广播**信标帧**，每个信标帧包含其 SSID 和 MAC 地址。设备可通过两种方式进行扫描以获取这些信息：

- **被动扫描**：依次监听所有 11 个信道，收集收到的信标帧；  
- **主动扫描**：向所有信道广播**探测请求帧**，附近的 AP 会立即回复**探测响应帧**。

发现可用 AP 后，设备需要决定关联哪一个。802.11 标准并未规定具体选择算法，这通常由设备固件实现。最常见的策略是选择**信号最强的 AP**，但这并非总是最优选择，因为信号强的 AP 可能已连接大量用户而导致带宽拥挤，而稍弱但空闲的 AP 反而可能提供更好的使用体验。

选定 AP 后，设备发送**关联请求帧**，AP 回复**关联响应帧**，完成关联。这一步类似于 DHCP 客户端从多个服务器中选择一个，需明确确认最终选择。

关联成功后，设备通常会通过该 AP 发起 **DHCP 请求**，获取该子网的 IP 地址，从而正式成为该网络的一员。

最后，许多网络还要求**身份认证**，常见方式包括基于 MAC 地址的白名单或用户名/密码登录（如咖啡馆的网页认证）。在实际部署中，AP 通常将认证请求转发给后台的**认证服务器**（如 RADIUS 服务器），实现集中管理，使得一个鉴别服务器能够服务于多个 AP，同时降低 AP 本身的复杂度。这一架构也被现代安全标准（如 802.11i）所采用。

### 802.11 MAC 协议
一旦无线设备与 AP 成功关联，就可以通过该 AP 发送和接收数据帧。然而，由于多个站点共享同一无线信道，必须使用**多路访问协议**来协调传输。受以太网经验启发，802.11 采用了一种**随机接入协议**，称为**载波侦听多路访问/碰撞避免**（CSMA/CA）。与以太网的 CSMA/CD 类似，CSMA/CA 也要求站点在发送前先侦听信道，如果信道忙则推迟发送，但两者存在两个关键区别：

- 802.11 使用“碰撞避免”，而非“碰撞检测”；  
- 802.11 引入了链路层确认与重传机制（ARQ），而传统以太网没有。

802.11 不采用碰撞检测主要有两点原因：无线网卡无法在发送的同时可靠接收信号，因发射功率远大于接收信号，实现碰撞检测的硬件既复杂又昂贵；同时，即便能监听，隐藏终端和信号衰减也会使碰撞难以被准确识别。因此，802.11 一旦开始发送就会将帧完整发送到底，不像以太网那样在检测到碰撞后中止。为降低碰撞带来的开销，802.11 标准依赖随机回退、RTS/CTS 等碰撞避免机制，使冲突尽量不发生。

具体来说，CSMA/CA 引入了**随机回退**机制，在信道由忙转空时让各站点独立倒计时，只要回退值不同，就能错开发送时机；且在倒计时过程中，一旦侦听到其他设备开始传输，站点会立即冻结计数器，待信道再次空闲后再继续，从而进一步减少碰撞的可能性。

当然，即使采用 CSMA/CA 机制，碰撞仍可能发生，例如两个站点是彼此感知不到的“隐藏终端”，或它们的随机回退值过于接近，从而几乎同时开始发送。

此外，为应对无线链路较高的错误率，802.11 采用**链路层确认机制**：  
- 接收方在收到并通过 CRC 校验的帧后，会等待一个很短的固定时间，称为**短帧间间隔**（Short Inter-Frame Spacing, SIFS），然后发送一个**ACK 帧**。
- 发送方若在规定时间内未收到 ACK，就认为传输失败，并使用 CSMA/CA 重传该帧；  
- 若重传多次仍失败，则放弃该帧。

在了解 802.11 采用的随机回退和链路层确认机制之后，我们可以更完整地描述 CSMA/CA 的工作流程。假设某个站点（无线设备或 AP）有帧需要发送，它会按照以下步骤进行操作：

1. **若信道处于空闲状态**，站点不会立刻发送，而是先等待一个固定的短时间，即**分布式帧间间隔**（Distributed Inter-Frame Space, DIFS），随后才开始发送。
2. **如果信道忙**，站点会随机选择一个“回退计数值”，并在信道空闲时逐单位递减；信道一旦变忙，计数暂停。  
3. **当计数值减到 0 时**（此时信道必定空闲），站点发送整个数据帧，并等待接收方的 ACK 确认。  
4. **若收到 ACK**，说明传输成功；若需发送下一帧，则重新进入步骤 2。  
   **若未收到 ACK**，则视为失败，站点回到步骤 2，但**从更大的随机范围内选择新的回退值**（类似二进制指数后退）。

基础的 802.11 协议就是这样，已经能够解决大多数情况，但在此之上还引入了一些有趣的拓展机制，例如利用 RTS/CTS 帮助解决隐藏终端问题、将 802.11 用作点对点链路以拓展部署方式等，使无线网络在更复杂的环境中仍能保持较高的通信效率。

#### 处理隐藏终端：RTS/CTS 机制
802.11 MAC 协议提供了一种可选但有效的**信道预约机制**，用于缓解隐藏终端问题。其要解决的情形是，若 H1 正在向 AP 发送数据，而 H2 又听不到 H1 的传输，那么 H2 可能在中途开始发送，从而在 AP 处形成碰撞，使双方的帧都无法成功接收并导致信道资源被浪费。

为避免这种情况，802.11 允许发送方在传输数据前先进行预约：

1. 发送方（如 H1）向 AP 发送一个短**请求发送**（Request to Send, RTS）控制帧，其中包含后续数据帧和确认帧所需的总时间；  
2. AP 收到 RTS 后，广播一个短**允许发送**（Clear to Send, CTS）控制帧作为响应；  
3. 所有收到 CTS 的站点（包括隐藏的 H2）都会在指定时间内**暂停发送**，为即将进行的数据传输让出信道。

由于 RTS 和 CTS 帧都很短，即使发生碰撞，代价也远低于长数据帧的碰撞。一旦 RTS/CTS 成功交换，后续的数据帧和确认帧便能在受保护的时间窗口内无冲突地完成传输。通过这种以短控制帧方式提前预约信道的做法，RTS/CTS 能够有效缓解隐藏终端导致的碰撞，提升无线网络的可靠性与整体效率。

虽然 RTS/CTS 交换能够降低碰撞发生的概率，但同时也会带来额外时延并占用信道资源，因此该机制通常仅用于为较长的数据帧预约信道。实际中，每个无线站点都会配置一个 RTS 门限值，只有当即将发送的数据帧长度超过这一门限时才会启用 RTS/CTS。对于许多设备而言，默认的 RTS 门限值高于最大帧长，因此所有 DATA 帧都会直接发送，RTS/CTS 序列在绝大多数情况下被跳过。

#### 使用 802.11 作为点对点链路
前面的讨论聚焦于 802.11 在多路访问（共享信道）场景下的工作方式。但实际上，802.11 也可用于**点对点通信**，只要两个节点配备**定向天线**并相互对准，就能在一条专用无线链路上运行 802.11 协议。

由于商用 802.11 硬件成本低廉，通过搭配定向天线和适当提升发射功率，802.11 可以成为一种经济高效的方案，用于建立数十公里距离的无线点对点连接。这种模式已被用于构建远距离多跳无线网络，例如在偏远地区提供互联网接入。

### IEEE 802.11 帧
尽管 802.11 帧与以太网帧在功能上相似，但为适应无线环境，其结构包含一些特有的字段，如下图所示：
<figure style="text-align: center;">
<img src="/illustrations/计网笔记7/2.png" alt="802.11 帧" width="80%">
<figcaption>802.11 帧</figcaption>
</figure>

1. 有效载荷与 CRC  
   - **有效载荷**：通常是一个 IP 数据报或 ARP 分组，最大可达 2312 字节，但一般不超过 1500 字节（以太网 MTU）；
   - **CRC 字段**（4 字节）：用于检测传输中的比特错误。由于无线链路误码率较高，CRC 在此尤为重要。

2. 四个地址字段  
   802.11 帧包含**最多四个 MAC 地址字段**（各 6 字节），这在以太网中是没有的。在**基础设施模式**下，主要使用前三个：

   - **地址 1**：帧的**接收方**（如 AP 或无线站点）的 MAC 地址；  
   - **地址 2**：帧的**发送方**（如无线站点或 AP）的 MAC 地址；  
   - **地址 3**：无线链路外**真正的通信对端**（一般是路由器）的 MAC 地址，用于桥接无线与有线网络。

   之所以需要地址 3，是因为 AP 在无线与有线网络之间承担着桥接角色。当有线侧的路由器将数据发往无线站点时，它会根据目标 IP 通过 ARP 获得无线站点的 MAC 地址，并封装成 802.3 以太网帧；AP 接收到该帧后会将其转换为 802.11 格式，其中地址 1 是无线站点的 MAC（实际接收者），地址 2 是 AP 的 MAC（无线侧发送者），地址 3 则保留原始以太网帧中的路由器 MAC（最初的发送者）。反向通信时，无线站点会把地址 3 设置为路由器的 MAC，使 AP 能知道如何将帧从无线侧转发回有线侧。因此，地址 3 对 AP 的桥接功能至关重要，它让 AP 能在不同链路层格式之间保持正确的转发，而无需解析更高层的 IP 信息。

   > 第四个地址用于自组织网络中的多跳转发，基础设施模式中通常不使用。

3. 控制字段  
   - **序号字段**：用于识别重传帧，避免重复处理（类似 TCP 序号）；  
   - **持续期字段**：在 RTS/CTS 或数据帧中指明信道将被占用的时长，供其他站点协调退避；  
   - **帧控制字段**：包含多个标志位，其中关键的有：
      - **类型/子类型**：区分数据帧、ACK、RTS、CTS、管理帧等；
      - **To AP / From AP**：指示帧的流向，帮助解析各地址字段的含义；
      - **WEP 位**：标志是否启用加密。

综上，802.11 帧通过扩展地址和控制字段，有效支持了无线环境下的桥接、可靠传输与多路访问协调，同时保持与有线以太网的兼容性。
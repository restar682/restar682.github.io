---
title: 计网学习笔记-2
date: 2025-10-19 10:51:16
categories: 计网
description: 《计算机网络——自顶向下方法》第二章学习笔记。
tags: [计算机网络, 应用层]
---
# 应用层
## 应用层协议
如前所述，应用软件的运行被限制在主机中，因此，我们只需专注于开发能够在不同端系统上运行并通过网络实现相互通信的程序，而无需关心网络核心设备的实现细节或兼容性问题。

### 应用程序体系结构
对于一个应用程序而言，网络的体系结构是固定的，它只是为应用提供了特定的服务集合，或者说接口。但应用程序自身的体系结构则是由研发者自己设计的，规定了如何在各个主机上组织该应用程序。现代网络应用程序有两种主流体系结构：客户——服务器体系结构、对等（P2P）体系结构。

在客户——服务器体系结构中，有一台始终处于开启状态的主机被称作**服务器**，它为许多其他被称作**客户**的主机提供服务。在这个体系结构中，客户相互之间并不通信，而服务器具有固定的 IP 地址，且始终保持打开，因此客户总是能够通过向该服务器的 IP 地址发送分组来与其建立联系。典型的基于该架构的应用包括 Web 浏览（HTTP）和电子邮件（SMTP、IMAP 等）。

而在 P2P 体系结构中，应用程序几乎不依赖（甚至完全不依赖）专用服务器，而是由间歇性连接的主机之间直接通信，这些主机被称为**对等方**。典型的 P2P 应用包括 **BitTorrent**（文件共享）、**Bitcoin**（去中心化数字货币）和 **Skype**（早期的语音通话），它们都依靠对等节点直接通信，无需依赖中心服务器。P2P 的最大优势之一在于其自扩展性，尽管每个对等方都由于请求文件产生负载，但他们本身向其它对等方分发文件也为系统增加了服务能力。然而，由于高度非集中式结构，P2P 结构也会面临安全性、性能等挑战。

### 进程通信
我们知道，进行通信的实际上是各个主机上的进程，他们通过交换报文来相互通信。为了方便叙述，我们称发起通信的进程为客户，等待联系的进程为服务器。

进程通过被称作**套接字**的软件接口向网络发送和接收报文。套接字位于同一台主机内应用层与运输层之间，本质上是应用程序与网络之间的 API。应用程序对其在应用层一侧的套接字拥有完全控制权，但在运输层一侧的控制非常有限：通常只能选择运输层协议（如 TCP 或 UDP），并设置少数参数（如最大缓存大小、最大报文段长度等）。一旦选定协议，应用程序便运行在该协议所提供的运输层服务之上，无法再干预其内部机制（如拥塞控制或重传策略）。大致流程如图：

<figure style="text-align: center;">
  <img src="/illustrations/计网笔记2/1.png" alt="套接字" width="80%">
  <figcaption>套接字</figcaption>
</figure>

为了向服务器发送分组，我们需要服务器的地址和指定接收进程的标识符。在因特网中，主机由其 IP 地址唯一标识，而接收进程则通过目的端口号来指定。端口号的相关内容将在第3章介绍，IP 协议的细节则在第4章展开。

### 运输服务
我们会从四个方面来评估运输层协议能够提供的服务：可靠数据传输、吞吐量、定时和安全性。

- **可靠数据传输**指的是协议能够确保发送方发出的数据被接收方**正确、完整且按序**地交付，即使底层网络可能丢包、损坏或乱序。例如，TCP 通过确认、重传和校验机制实现可靠性，而 UDP 不提供此类保障。
- **吞吐量**指协议能为应用提供的可用带宽或数据传输速率。某些协议或网络环境可提供高吞吐量（如视频流所需的稳定带宽），而另一些则仅提供“尽力而为”的服务，实际吞吐量受网络拥塞等因素影响。具有吞吐量要求的应用被称作“带宽敏感的应用”，而没有要求的一般被称作弹性应用。
- **定时**涉及数据交付的延迟特性，如端到端时延、抖动或是否满足实时性要求。这对交互式应用（如语音通话、在线游戏）至关重要，但标准 TCP/UDP 本身不保证定时性能，需结合其他机制（如 QoS 或应用层优化）。
- **安全性**包括数据的机密性、完整性和端点认证。基础的运输层协议（如 TCP/UDP）不内置加密或认证，但可通过扩展（如 TLS/SSL）或使用安全协议（如 DTLS、QUIC 内置加密）来提供保护。

这四个维度共同决定了运输层协议是否适合特定应用的需求。在因特网中，主要提供两种运输层协议：**TCP** 和 **UDP**。

TCP 协议提供**面向连接的服务**和**可靠数据传输服务**。所谓面向连接，是指在应用层数据开始传输之前，TCP 要求客户和服务器先通过交换运输层控制信息完成**三次握手**，从而建立一条 TCP 连接；连接建立后，双方进程即可同时收发数据。通信结束后，还需通过**四次挥手**显式地拆除连接。而“可靠”如前所述，意味着 TCP 能确保所有数据被正确、完整且按序地交付给接收方。

需要说明的是，TCP 本身不提供安全性。为了实现加密、身份认证和数据完整性保护，通常会在 TCP 之上叠加 **SSL/TLS**（安全套接层/传输层安全）协议。SSL/TLS 并非独立的运输层协议，而是位于应用层与 TCP 之间的一层安全增强机制——应用数据先由 SSL/TLS 加密封装，再交由 TCP 传输。因此，像 HTTPS、安全邮件等，本质上是“**应用层 + SSL/TLS + TCP**”的组合，既保留了 TCP 的可靠性，又获得了端到端的安全保障。

UDP 协议则是一种**轻量级、无连接**的运输层协议，仅提供**最小限度的传输服务**。它在发送数据前**无需建立连接**，也不保证数据的可靠交付——既不重传丢失的报文，也不确保顺序或完整性。此外，UDP **没有流量控制和拥塞控制机制**，发送方可以以任意速率发送数据，即使网络已拥塞。这种“尽力而为”的设计使其开销极低、延迟小，适用于对实时性要求高、能容忍少量丢包的应用，如视频会议、在线游戏和 DNS 查询。

### 应用层协议
终于，我们来谈到这一节的标题了。应用层协议定义了运行在不同端系统上的应用程序进程之间如何交换报文。具体而言，它规定了以下内容：  

- **报文类型**，例如请求报文与响应报文；  
- **报文的语法**，即报文的结构、包含哪些字段以及各字段的格式；  
- **字段的语义**，也就是每个字段所表达的具体含义；  
- **通信规则**，包括一个进程在何种条件下发送报文，以及如何对收到的报文进行响应。  

有些应用层协议是由 RFC 文档定义的，属于公开标准，任何人都可以自由实现和使用；而另一些则是专有协议，由特定公司或组织私有控制，通常不公开细节或限制使用。需要注意的是，应用层协议本质上是应用程序的一部分，而非整个应用程序本身。

## Web 和 HTTP
### HTTP 概况
Web 的应用层协议是超文本传输协议（HyperText Transfer Protocol, HTTP），它是客户——服务器架构的。Web 页面由多个对象组成，每个对象是一个可通过 **URL**（统一资源定位符）寻址的文件。大多数 Web 页面包含一个 HTML 基础文件以及若干被引用的对象（如图片、样式表、脚本等），HTML 文件通过这些对象的 URL 在页面中引用它们。Web 服务器实现了 HTTP 协议的服务器端，负责存储这些 Web 对象，并响应客户端的请求。

HTTP 定义了 Web 客户端向服务器请求 Web 页面的方式，以及服务器向客户端传送页面的规则。当用户请求一个页面时，浏览器（作为 HTTP 客户端）会向目标服务器发送一个 HTTP 请求报文，指定所需资源的 URL；服务器随后处理该请求，并返回相应的 HTTP 响应报文，其中包含所请求的 Web 对象（如 HTML 文件或其他资源）。

HTTP 采用 TCP 作为运输协议，客户端与服务器在传输数据前先建立 TCP 连接，之后就可以通过套接字接口访问 TCP。

事实上，HTTP 是一个无状态协议，因为它不会保存关于客户的任何信息。正因如此，即使客户短时间内多次请求同一个对象，服务器也总会做出相同的反应。

### 持续/非持续连接
在许多因特网应用程序中，客户和服务器需要在较长时间内进行多次交互，客户会发送一系列请求，服务器也需要对每个请求作出响应。这种交互是通过 TCP 进行的，因此，是所有请求——响应对共同使用一个 TCP 还是每个请求——响应对使用单独的 TCP 会是相当重要的一个设计选择。我们将前一种称之为持续连接，后一种则称作非持续连接。HTTP 默认采用持续连接以提升效率，但也可配置为非持续连接。

为了对比两者的时间差异，我们需要引入往返时间（Round-Trip Time, RTT）。RTT 是指一个小数据包从发送方发出，到达接收方后立即返回确认，再回到发送方所经历的总时间。它反映了网络链路的延迟特性，包含了传播时延、排队时延、处理时延等，但通常不包括数据传输时延（因为使用的是小探测包）。

在非持续连接模式下，每次请求一个 Web 对象都需要经历完整的 TCP 三次握手和一次 HTTP 请求——响应交互。具体过程如下：

1. **TCP 三次握手**：客户端发送 SYN（第1步），服务器回复 SYN-ACK（第2步），客户端再发送 ACK（第3步）。前两步构成1个 RTT，第3步的 ACK 通常与后续的 HTTP 请求合并发送，因此握手阶段至少消耗1个 RTT。
2. **HTTP 请求与响应**：客户端发送 HTTP 请求，服务器返回响应对象，这一来一回再消耗1个 RTT以及传输 HTML 文件的时间。

因此，获取一个 Web 对象在非持续连接下总共需要约2个 RTT + 传输 HTML 文件的时间。相比之下，在持续连接下，TCP 连接在多个请求之间复用，理论上可以节省“对象数-1”个 RTT 的时间。

此外，非持续连接需要为每个请求单独建立和维护一个 TCP 连接，而每个连接都需分配独立的 TCP 缓冲区并维护相应的状态变量，这无疑会给客户端和服务器带来显著的资源开销和管理负担，也是非持续连接明显的缺陷之一。

### HTTP 报文格式
HTTP 报文分为请求报文和响应报文。
1. 请求报文
  下图是一个典型的 HTTP 请求报文：
  <figure style="text-align: center;">
    <img src="/illustrations/计网笔记2/2.png" alt="请求报文" width="80%">
  </figure>

  我们可以看到，报文是用 ASCII 文本书写的，每行以一个回车和换行符结束。HTTP 报文的第一行是**请求行**，其后继的行叫**首部行**。请求行有三个字段：方法字段、URL 字段、HTTP 版本字段。方法字段可以取几种不同的值，包括 GET, POST, HEAD, PUT 和 DELETE，绝大部分使用 GET 方法。
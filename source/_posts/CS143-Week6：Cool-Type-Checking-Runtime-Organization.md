---
title: CS143-Week6：Cool Type Checking & Runtime Organization
date: 2025-08-16 12:22:55
categories: CS143
description: 
tags: [编译原理, Linux, CS143, 语义分析]
---
# Cool 的类型检查
## 静态类型与动态类型
**静态类型（Static Typing）** 是一种编译时的类型系统，变量或表达式的类型在编译阶段就已经确定，编译器会在此时进行类型检查，我们之前讲的就是这种类型系统。这种方式能够提前发现错误，但也可能拒绝一些在运行时实际上可以正确执行的程序。换句话说，静态类型刻画的是**变量或表达式在所有可能执行路径下所能具有的类型集合**（编译期约束）。

**动态类型（Dynamic Typing）** 在这里有两层含义：  
1. **静态类型语言中的运行时对象类型**：变量的静态类型固定，但它所引用的对象在运行时可能是静态类型的子类，决定运行时行为，这就是所谓的动态类型。例如在 Java 中：
```java
Animal a = new Dog(); // 变量 a 的静态类型是 Animal，动态类型是 Dog
a = new Cat();        // 动态类型变为 Cat，但静态类型仍是 Animal
```

2. **动态类型语言中的变量绑定类型**：变量本身没有固定类型，运行时绑定什么对象，类型就是什么，类型检查完全在运行时进行。例如 Python：
```python
x = 5      # 运行时类型是 int
x = "hi"   # 运行时类型变为 str
```

**区别**：静态类型语言变量的静态类型固定，也即类型检查时类型固定，但运行时对象类型可变化（向下转型受限）；动态类型语言变量没有固定类型，完全由运行时决定。

类型系统的健全性保证了静态类型与动态类型的一致性：对于任意表达式 $E$，其运行时的动态类型（对象类型）始终是其静态类型的子类型，从而确保编译期推导出的类型在运行时是安全的。子类型安全要求子类只能增加属性或方法，并允许方法重定义，但方法的类型签名必须保持不变。这样，所有对类型 $C$ 对象合法的操作，也同样适用于其子类型 $C' < C$ 的对象，包括属性访问和方法调用，从而保证了子类型的安全性和多态的正确性。

## $SELF\\_TYPE$
$SELF\\_TYPE$ 是一种特殊的类型标记，表示方法或属性的返回类型与调用对象的动态类型一致。  
- **静态视角**：在编译期，SELF_TYPE 是占位类型，用于静态类型检查，表示返回类型依赖于调用对象。  
- **动态视角**：在运行时，SELF_TYPE 的实际类型由调用对象的动态类型决定，从而支持多态行为。  
- **特性**：它既保证类型安全（编译期检查可通过），又允许返回类型根据运行时对象动态变化，类似“动态类型的占位符”。